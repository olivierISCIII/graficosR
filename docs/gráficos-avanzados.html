<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Gráficos avanzados | Gráficos con R</title>
  <meta name="description" content="2 Gráficos avanzados | Gráficos con R" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Gráficos avanzados | Gráficos con R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Gráficos avanzados | Gráficos con R" />
  
  
  

<meta name="author" content="Olivier Nuñez" />


<meta name="date" content="2021-10-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="gráficos-básicos-en-el-análisis-de-datos.html"/>
<link rel="next" href="rmarkdown.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preámbulo</a></li>
<li class="chapter" data-level="1" data-path="gráficos-básicos-en-el-análisis-de-datos.html"><a href="gráficos-básicos-en-el-análisis-de-datos.html"><i class="fa fa-check"></i><b>1</b> Gráficos básicos en el análisis de datos</a>
<ul>
<li class="chapter" data-level="1.1" data-path="gráficos-básicos-en-el-análisis-de-datos.html"><a href="gráficos-básicos-en-el-análisis-de-datos.html#distribución-de-una-variable"><i class="fa fa-check"></i><b>1.1</b> Distribución de una variable</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="gráficos-básicos-en-el-análisis-de-datos.html"><a href="gráficos-básicos-en-el-análisis-de-datos.html#histograma"><i class="fa fa-check"></i><b>1.1.1</b> Histograma</a></li>
<li class="chapter" data-level="1.1.2" data-path="gráficos-básicos-en-el-análisis-de-datos.html"><a href="gráficos-básicos-en-el-análisis-de-datos.html#diagrama-de-caja-boxplot"><i class="fa fa-check"></i><b>1.1.2</b> Diagrama de caja (boxplot)</a></li>
<li class="chapter" data-level="1.1.3" data-path="gráficos-básicos-en-el-análisis-de-datos.html"><a href="gráficos-básicos-en-el-análisis-de-datos.html#diagrama-de-barras"><i class="fa fa-check"></i><b>1.1.3</b> Diagrama de barras</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="gráficos-básicos-en-el-análisis-de-datos.html"><a href="gráficos-básicos-en-el-análisis-de-datos.html#relación-entre-dos-variables"><i class="fa fa-check"></i><b>1.2</b> Relación entre dos variables</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="gráficos-básicos-en-el-análisis-de-datos.html"><a href="gráficos-básicos-en-el-análisis-de-datos.html#diagrama-de-dispersión"><i class="fa fa-check"></i><b>1.2.1</b> Diagrama de dispersión</a></li>
<li class="chapter" data-level="1.2.2" data-path="gráficos-básicos-en-el-análisis-de-datos.html"><a href="gráficos-básicos-en-el-análisis-de-datos.html#dotchart"><i class="fa fa-check"></i><b>1.2.2</b> Dotchart</a></li>
<li class="chapter" data-level="1.2.3" data-path="gráficos-básicos-en-el-análisis-de-datos.html"><a href="gráficos-básicos-en-el-análisis-de-datos.html#relación-con-una-variable-temporal"><i class="fa fa-check"></i><b>1.2.3</b> Relación con una variable temporal</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="gráficos-avanzados.html"><a href="gráficos-avanzados.html"><i class="fa fa-check"></i><b>2</b> Gráficos avanzados</a>
<ul>
<li class="chapter" data-level="2.1" data-path="gráficos-avanzados.html"><a href="gráficos-avanzados.html#elementos-de-un-gráfico"><i class="fa fa-check"></i><b>2.1</b> Elementos de un gráfico</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="gráficos-avanzados.html"><a href="gráficos-avanzados.html#datos"><i class="fa fa-check"></i><b>2.1.1</b> Datos</a></li>
<li class="chapter" data-level="2.1.2" data-path="gráficos-avanzados.html"><a href="gráficos-avanzados.html#estéticas-aes"><i class="fa fa-check"></i><b>2.1.2</b> Estéticas (<code>aes</code>)</a></li>
<li class="chapter" data-level="2.1.3" data-path="gráficos-avanzados.html"><a href="gráficos-avanzados.html#capas-geoms"><i class="fa fa-check"></i><b>2.1.3</b> Capas (<code>geoms</code>)</a></li>
<li class="chapter" data-level="2.1.4" data-path="gráficos-avanzados.html"><a href="gráficos-avanzados.html#facetas"><i class="fa fa-check"></i><b>2.1.4</b> Facetas</a></li>
<li class="chapter" data-level="2.1.5" data-path="gráficos-avanzados.html"><a href="gráficos-avanzados.html#toque-final"><i class="fa fa-check"></i><b>2.1.5</b> Toque final</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="gráficos-avanzados.html"><a href="gráficos-avanzados.html#mapas"><i class="fa fa-check"></i><b>2.2</b> Mapas</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="gráficos-avanzados.html"><a href="gráficos-avanzados.html#más-ejemplos-de-mapas-con-puntos"><i class="fa fa-check"></i><b>2.2.1</b> Más ejemplos de mapas con puntos</a></li>
<li class="chapter" data-level="2.2.2" data-path="gráficos-avanzados.html"><a href="gráficos-avanzados.html#más-allá-de-los-puntos-densidades-y-poligonos"><i class="fa fa-check"></i><b>2.2.2</b> Más allá de los puntos: densidades y poligonos</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="gráficos-avanzados.html"><a href="gráficos-avanzados.html#árboles-filogenéticos"><i class="fa fa-check"></i><b>2.3</b> Árboles filogenéticos</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="gráficos-avanzados.html"><a href="gráficos-avanzados.html#importación-de-un-árbol"><i class="fa fa-check"></i><b>2.3.1</b> Importación de un árbol</a></li>
<li class="chapter" data-level="2.3.2" data-path="gráficos-avanzados.html"><a href="gráficos-avanzados.html#representación-básica"><i class="fa fa-check"></i><b>2.3.2</b> Representación básica</a></li>
<li class="chapter" data-level="2.3.3" data-path="gráficos-avanzados.html"><a href="gráficos-avanzados.html#agrupación-de-nodos"><i class="fa fa-check"></i><b>2.3.3</b> Agrupación de nodos</a></li>
<li class="chapter" data-level="2.3.4" data-path="gráficos-avanzados.html"><a href="gráficos-avanzados.html#añadir-heatmap"><i class="fa fa-check"></i><b>2.3.4</b> Añadir Heatmap</a></li>
<li class="chapter" data-level="2.3.5" data-path="gráficos-avanzados.html"><a href="gráficos-avanzados.html#visualización-de-multiple-arboles"><i class="fa fa-check"></i><b>2.3.5</b> Visualización de multiple arboles</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>3</b> Rmarkdown</a>
<ul>
<li class="chapter" data-level="3.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown-en-15-mn"><i class="fa fa-check"></i><b>3.1</b> Rmarkdown en 15 mn</a></li>
<li class="chapter" data-level="3.2" data-path="rmarkdown.html"><a href="rmarkdown.html#elementos-de-un-documento-rmarkdown"><i class="fa fa-check"></i><b>3.2</b> Elementos de un documento Rmarkdown</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="rmarkdown.html"><a href="rmarkdown.html#encabezado-préambulo"><i class="fa fa-check"></i><b>3.2.1</b> Encabezado (préambulo)</a></li>
<li class="chapter" data-level="3.2.2" data-path="rmarkdown.html"><a href="rmarkdown.html#texto-del-documento"><i class="fa fa-check"></i><b>3.2.2</b> Texto del documento</a></li>
<li class="chapter" data-level="3.2.3" data-path="rmarkdown.html"><a href="rmarkdown.html#bloques-de-codigo"><i class="fa fa-check"></i><b>3.2.3</b> Bloques de codigo</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="rmarkdown.html"><a href="rmarkdown.html#tablas-con-rmarkdown"><i class="fa fa-check"></i><b>3.3</b> Tablas con Rmarkdown</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="rmarkdown.html"><a href="rmarkdown.html#tablas-cruzadas"><i class="fa fa-check"></i><b>3.3.1</b> Tablas cruzadas</a></li>
<li class="chapter" data-level="3.3.2" data-path="rmarkdown.html"><a href="rmarkdown.html#base-de-datos"><i class="fa fa-check"></i><b>3.3.2</b> Base de datos</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="referencias.html"><a href="referencias.html"><i class="fa fa-check"></i><b>4</b> Referencias</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Gráficos con R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="gráficos-avanzados" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Gráficos avanzados</h1>
<p>Esta sección es una introducción a las ideas del libro <em>The Grammar of Graphics</em> de Leland Wilkinson (2005) tal y como vienen implementadas en el paquete <code>ggplot2</code> de Hadley Wickham (2009).</p>
<p align="center">
<img src="imagenes/wilkinson.jpg" width="200" />
<img src="imagenes/Wickham.jpg" width="200" />
</p>
<p>A continuación veremos los elementos principales de esta gramática y como nos permiten elaborar de manera sencilla representaciones visuales del comportamiento de una variable de interés a través de los distintos niveles de otras.</p>
<p>El gráfico siguiente muestra la evolución de la tasa de mortalidad por cáncer según la localización, en España durante el periodo 1975-2012.</p>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-54-1.png" width="1152" /></p>
<div id="elementos-de-un-gráfico" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Elementos de un gráfico</h2>
<p>El gráfico anterior, se obtuvo de la siguiente manera. En primer lugar, se carga los datos de mortalidad:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="gráficos-avanzados.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(data.table)</span>
<span id="cb24-2"><a href="gráficos-avanzados.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/cancer.RDA&quot;</span>) <span class="co">#carga los datos</span></span>
<span id="cb24-3"><a href="gráficos-avanzados.html#cb24-3" aria-hidden="true" tabindex="-1"></a>cancer</span></code></pre></div>
<pre><code>##          sexo periodo             tumor       tasa
##    1: Hombres    1975 C.BUCAL Y FARINGE   5.541879
##    2: Hombres    1976 C.BUCAL Y FARINGE   5.512168
##    3: Hombres    1977 C.BUCAL Y FARINGE   5.827874
##    4: Hombres    1978 C.BUCAL Y FARINGE   5.323451
##    5: Hombres    1979 C.BUCAL Y FARINGE   5.461059
##   ---                                             
## 3188: Mujeres    2008 TODOS MUERTOS     385.294977
## 3189: Mujeres    2009 TODOS MUERTOS     373.009470
## 3190: Mujeres    2010 TODOS MUERTOS     359.444478
## 3191: Mujeres    2011 TODOS MUERTOS     357.461639
## 3192: Mujeres    2012 TODOS MUERTOS     359.691700</code></pre>
<p>La expresión de <code>ggplot2</code> para crear el gráfico fue:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="gráficos-avanzados.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cancer) <span class="sc">+</span></span>
<span id="cb26-2"><a href="gráficos-avanzados.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> periodo, <span class="at">y =</span> tasa, <span class="at">col =</span> sexo) <span class="sc">+</span></span>
<span id="cb26-3"><a href="gráficos-avanzados.html#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb26-4"><a href="gráficos-avanzados.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> tumor) </span></code></pre></div>
<p>Esta expresión combina varios elementos que discutiremos en detalle a continuación:</p>
<ul>
<li><strong>Datos</strong>: siempre un “data.frame”</li>
<li><strong>Estéticas</strong>: elementos representables gráficamente (la posición <code>x</code> e <code>y</code>, el color, la forma, …) en columnas del data.frame.</li>
<li><strong>Geometrías</strong> (o capas): puntos, rectas, histogramas, densidades, etc. También se llaman capas porque pueden superponerse.</li>
<li><strong>Facetas</strong>: parten un gráfico en sublienzos preservando las escalas (pequeños múltiplos)</li>
</ul>
<div id="datos" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Datos</h3>
<p>Uno de los elementos más importantes de un gráfico son los datos que se quieren representar. Una particularidad de <code>ggplot2</code> es que solo acepta un tipo de datos: un <code>data.frame</code>.</p>
<p>Por otro lado, es preferible que los datos estén en un formato “largo” (long format), es decir, una columna para cada dimensión y una fila para cada observación.</p>
<p>Para ilustrar esta idea, se considera la base de datos <code>VADeaths</code> que proporciona tasas de mortalidad (por 1000 personas/año) en Virginia (1940) por grupos socio-demográficos y de edad.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Rural Male</th>
<th align="right">Rural Female</th>
<th align="right">Urban Male</th>
<th align="right">Urban Female</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">50-54</td>
<td align="right">11.7</td>
<td align="right">8.7</td>
<td align="right">15.4</td>
<td align="right">8.4</td>
</tr>
<tr class="even">
<td align="left">55-59</td>
<td align="right">18.1</td>
<td align="right">11.7</td>
<td align="right">24.3</td>
<td align="right">13.6</td>
</tr>
<tr class="odd">
<td align="left">60-64</td>
<td align="right">26.9</td>
<td align="right">20.3</td>
<td align="right">37.0</td>
<td align="right">19.3</td>
</tr>
<tr class="even">
<td align="left">65-69</td>
<td align="right">41.0</td>
<td align="right">30.9</td>
<td align="right">54.6</td>
<td align="right">35.1</td>
</tr>
<tr class="odd">
<td align="left">70-74</td>
<td align="right">66.0</td>
<td align="right">54.3</td>
<td align="right">71.1</td>
<td align="right">50.0</td>
</tr>
</tbody>
</table>
<p>Antes de representar los datos, convertimos la base en un formato alargado.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="gráficos-avanzados.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(data.table)</span>
<span id="cb27-2"><a href="gráficos-avanzados.html#cb27-2" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">=</span><span class="fu">as.data.table</span>(VADeaths,<span class="at">keep.rownames=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-3"><a href="gráficos-avanzados.html#cb27-3" aria-hidden="true" tabindex="-1"></a>mortalidad<span class="ot">=</span><span class="fu">melt</span>(temp,<span class="at">id.vars=</span><span class="st">&quot;rn&quot;</span>) <span class="co">#formato alargado</span></span>
<span id="cb27-4"><a href="gráficos-avanzados.html#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mortalidad) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;edad&quot;</span>,<span class="st">&quot;grupo&quot;</span>,<span class="st">&quot;tasa&quot;</span>)</span>
<span id="cb27-5"><a href="gráficos-avanzados.html#cb27-5" aria-hidden="true" tabindex="-1"></a>mortalidad</span></code></pre></div>
<pre><code>##      edad        grupo tasa
##  1: 50-54   Rural Male 11.7
##  2: 55-59   Rural Male 18.1
##  3: 60-64   Rural Male 26.9
##  4: 65-69   Rural Male 41.0
##  5: 70-74   Rural Male 66.0
##  6: 50-54 Rural Female  8.7
##  7: 55-59 Rural Female 11.7
##  8: 60-64 Rural Female 20.3
##  9: 65-69 Rural Female 30.9
## 10: 70-74 Rural Female 54.3
## 11: 50-54   Urban Male 15.4
## 12: 55-59   Urban Male 24.3
## 13: 60-64   Urban Male 37.0
## 14: 65-69   Urban Male 54.6
## 15: 70-74   Urban Male 71.1
## 16: 50-54 Urban Female  8.4
## 17: 55-59 Urban Female 13.6
## 18: 60-64 Urban Female 19.3
## 19: 65-69 Urban Female 35.1
## 20: 70-74 Urban Female 50.0</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="gráficos-avanzados.html#cb29-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mortalidad)</span></code></pre></div>
<p>El código anterior crea un objeto, <code>p</code> que viene a ser un proto-gráfico: contiene los datos que vamos a utilizar, los del conjunto de datos <code>mortalidad</code>. Obviamente, el código anterior es insuficiente para crear un gráfico: aún no hemos indicado qué queremos hacer con <code>mortalidad</code>.</p>
</div>
<div id="estéticas-aes" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Estéticas (<code>aes</code>)</h3>
<p>En un conjunto de datos hay columnas: edad, altura, ingresos, temperatura, etc. En un gráfico hay, en la terminología de <code>ggplot2</code>, <em>aesthetic</em>. Estéticas son, por ejemplo, la distancia horizontal o vertical, el color, la forma (de un punto), el tamaño (de un punto o el grosor de una línea), etc.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="gráficos-avanzados.html#cb30-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> edad, <span class="at">y =</span> tasa, <span class="at">colour =</span> grupo)</span></code></pre></div>
<p>se están añadiendo a <code>p</code> información sobre las estéticas que tiene que utilizar y qué variables de <code>mortalidad</code> tiene que utilizar:</p>
<ul>
<li>La abscisa <code>x</code>, vendrá dada por el grupo de edad.</li>
<li>La ordenada <code>y</code>, por la tasa de mortalidad.</li>
<li>El color, por el grupo socio-demográfico.</li>
</ul>
<p>Al <em>protográfico</em> se le han sumado las estéticas. En las secciones siguientes se le <em>sumarán</em> otros elementos adicionales. Lo importante es recordar cómo la suma es el signo que combina los elementos que componen el lenguaje de los gráficos.</p>
<p>De todos modos, es habitual combinar ambos pasos en una única expresión</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="gráficos-avanzados.html#cb31-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mortalidad, <span class="fu">aes</span>(<span class="at">x =</span> edad, <span class="at">y =</span> tasa, <span class="at">colour =</span> grupo))</span></code></pre></div>
<p>El objeto <code>p</code> resultante aún no es un gráfico ni se puede representar. Le faltan capas, que es el objeto de la siguiente sección. No obstante, se puede inspeccionar la relación (o <em>mapeo</em>) entre estéticas y columnas de los datos:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="gráficos-avanzados.html#cb32-1" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>mapping</span></code></pre></div>
<pre><code>## Aesthetic mapping: 
## * `x`      -&gt; `edad`
## * `y`      -&gt; `tasa`
## * `colour` -&gt; `grupo`</code></pre>
<p>¿Cuántas estéticas existen? Alrededor de una docena, aunque se utilizan, generalmente, menos:</p>
<ul>
<li><code>x</code> e <code>y</code>, coordenadas horizontal y vertical.</li>
<li><code>colour</code>, para el color.</li>
<li><code>size</code>, para el tamaño.</li>
<li><code>shape</code>, que indica la forma de los puntos (cuadrados, triángulos, etc.) de los puntos o del trazo (continuo, punteado) de las líneas.</li>
<li><code>alpha</code> para la transparencia: los valores más altos tendrían formas opacas y los más bajos, casi transparentes. También muy útil para el solapamiento de puntos.</li>
<li><code>fill</code>, para el color de relleno de las formas sólidas (barras, etc.).</li>
</ul>
<div class="nota">
<p>
Hay que advertir que NO todas las <em>estéticas</em> tienen la misma potencia en un gráfico. El ojo humano percibe fácilmente longitudes distintas. Pero tiene problemas para comparar áreas (que es lo que regula la estética <code>size</code>) o intensidades de color. Se recomienda usar las estéticas más potentes para representar las variables más importantes.
</p>
</div>
</div>
<div id="capas-geoms" class="section level3" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Capas (<code>geoms</code>)</h3>
<p>Las capas (o <code>geoms</code> para <code>ggplot2</code>) son los verbos del lenguaje de los gráficos. Indican qué hacer con los datos y las estéticas elegidas, cómo representarlos en un lienzo:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="gráficos-avanzados.html#cb34-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb34-2"><a href="gráficos-avanzados.html#cb34-2" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<p>Una vez añadida una capa al gráfico, este puede pintarse (que es lo que ocurre al llamar a <code>p</code>). Se obtiene el mismo resultado haciendo, en una única línea,</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="gráficos-avanzados.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mortalidad, <span class="fu">aes</span>(<span class="at">x =</span> edad, <span class="at">y =</span> tasa, <span class="at">colour =</span> grupo)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p>Una característica de las capas, y de ahí su nombre, es que pueden superponerse. Por ejemplo,</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="gráficos-avanzados.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mortalidad, <span class="fu">aes</span>(<span class="at">x =</span> edad, <span class="at">y =</span> tasa, <span class="at">colour =</span> grupo, <span class="at">group=</span> grupo)) <span class="sc">+</span> </span>
<span id="cb36-2"><a href="gráficos-avanzados.html#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="gráficos-avanzados.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Se requiere la estética `group` para conectar los puntos de una linea cuando la variable en abscisa es un factor.</span></span></code></pre></div>
<p>Existen muchos tipos de capas. Los más usuales son <code>geom_point</code>, <code>geom_line</code>, <code>geom_histogram</code>, <code>geom_bar</code> y <code>geom_boxplot</code> (ver las página <code>https://ggplot2.tidyverse.org/reference/</code>) para una lista actualizada.</p>
<p>Abajo una representación mediante un diagrama de barra de los datos anteriores:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="gráficos-avanzados.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mortalidad, <span class="fu">aes</span>(<span class="at">x =</span> edad, <span class="at">y =</span> tasa, <span class="at">fill =</span> grupo)) <span class="sc">+</span> </span>
<span id="cb38-2"><a href="gráficos-avanzados.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<div class="ej">
<p>
Elaborar el siguientes gráfico sobre la evolución del paro en España. Utilizar la capa <code>geom_smooth</code> para suavizar la tendencia y la estética <code>linetype</code> para distintos tipos de curvas.
</p>
</div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-69-1.png" width="960" /></p>
<div class="ej">
<p>
Elaborar un gráfico sobre la evolución del número de hospitalización por COVID en España. Se podría utilizar la capa <code>geom_area</code> y la estética <code>fill</code> para distinguir mejor los distintos grupos de edad.
</p>
</div>
</div>
<div id="facetas" class="section level3" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> Facetas</h3>
<p>Las facetas permiten subdividir un gráfico y suele ser un recurso muy eficiente para describir el comportamiento de una variable en función de otra variable categórica. Así por ejemplo, con los datos de mortalidad,</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="gráficos-avanzados.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mortalidad, <span class="fu">aes</span>(<span class="at">x =</span> edad, <span class="at">y =</span> tasa)) <span class="sc">+</span> </span>
<span id="cb39-2"><a href="gráficos-avanzados.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-3"><a href="gráficos-avanzados.html#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>grupo)</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-71-1.png" width="1056" /></p>
<p>crea tres gráficos dispuestos horizontalmente que comparan la relación entre la anchura y la longitud del pétalo de las tres especies de iris. Una característica de estos gráficos, que es crítica para poder hacer comparaciones adecuadas, es que comparten ejes.</p>
<p>Los gráficos podrían disponerse verticalmente reemplazando <code>facet_grid(~grupo)</code> por <code>facet_grid(grupo~)</code> en el código anterior. Además, se puede subdividir el lienzo por dos (¡o más!) variables así:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="gráficos-avanzados.html#cb40-1" aria-hidden="true" tabindex="-1"></a>mortalidad[,<span class="fu">c</span>(<span class="st">&quot;zone&quot;</span>, <span class="st">&quot;sex&quot;</span>)<span class="sc">:</span><span class="er">=</span> <span class="fu">tstrsplit</span>(grupo, <span class="st">&quot; &quot;</span>)]</span>
<span id="cb40-2"><a href="gráficos-avanzados.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mortalidad, <span class="fu">aes</span>(<span class="at">x =</span> edad, <span class="at">y =</span> tasa)) <span class="sc">+</span> </span>
<span id="cb40-3"><a href="gráficos-avanzados.html#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb40-4"><a href="gráficos-avanzados.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(zone <span class="sc">~</span> sex)</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
<div class="ej">
<p>
Elaborar los siguientes gráficos sobre la evolución del paro. Para el segundo gráfico, se puede filtrar la base original con el comando:
</p>
<p>
paro.ZHT &lt;- subset(paro,Provincia %in% c(‘Zaragoza’, ‘Huesca’, ‘Teruel’))
</p>
</div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-74-1.png" width="1056" /><img src="graficosConR_files/figure-html/unnamed-chunk-74-2.png" width="1056" /></p>
<p>En caso de haber muchas categorías (p.e., todas las provincias), puede usarse la función <code>facet_wrap</code> para distribuir las subgráficas en una cuadrícula (ver gráfico a principio de la sección).</p>
<div class="ej">
<p>
Utilizando las facetas, describir en un único gráfico la evolución del COVID en España de acuerdo a las distintas variables contenidas en la correspondiente base de datos.
</p>
</div>
</div>
<div id="toque-final" class="section level3" number="2.1.5">
<h3><span class="header-section-number">2.1.5</span> Toque final</h3>
<div id="etiquetas" class="section level4" number="2.1.5.1">
<h4><span class="header-section-number">2.1.5.1</span> Etiquetas</h4>
<p>Las estéticas se pueden etiquetar con la función <code>labs</code>. Además, se le puede añadir un título al gráfico usando la función <code>ggtitle</code>. Por ejemplo, en el gráfico anterior se pueden re-etiquetar los ejes y la leyenda escribiendo</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="gráficos-avanzados.html#cb41-1" aria-hidden="true" tabindex="-1"></a>obesidad<span class="ot">&lt;-</span><span class="fu">fread</span>(<span class="st">&quot;data/obesidad.csv&quot;</span>)</span>
<span id="cb41-2"><a href="gráficos-avanzados.html#cb41-2" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggplot</span>(obesidad,<span class="fu">aes</span>(<span class="at">x=</span>renta,<span class="at">y=</span>imc,<span class="at">color=</span>region))<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>)</span>
<span id="cb41-3"><a href="gráficos-avanzados.html#cb41-3" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Relación entre Indice de Masa Corporal (IMC) y renta&quot;</span>) <span class="sc">+</span> </span>
<span id="cb41-4"><a href="gráficos-avanzados.html#cb41-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Renta (en miles de dolares por año)&quot;</span>, <span class="at">y =</span> <span class="fu">quote</span>(<span class="fu">IMC</span> (kg<span class="sc">/</span>m)), <span class="at">color =</span> <span class="st">&quot;Continente&quot;</span>)</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
</div>
<div id="escalas" class="section level4" number="2.1.5.2">
<h4><span class="header-section-number">2.1.5.2</span> Escalas</h4>
<p>Las escalas de las estéticas pueden ser modificadas para mejorar la claridad del gráfico.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="gráficos-avanzados.html#cb42-1" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">ggplot</span>(obesidad,<span class="fu">aes</span>(<span class="at">x=</span>renta,<span class="at">y=</span>imc))<span class="sc">+</span><span class="fu">geom_point</span>(<span class="at">size=</span>.<span class="dv">1</span>)<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>)</span>
<span id="cb42-2"><a href="gráficos-avanzados.html#cb42-2" aria-hidden="true" tabindex="-1"></a>p </span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="gráficos-avanzados.html#cb43-1" aria-hidden="true" tabindex="-1"></a>p<span class="sc">+</span><span class="fu">scale_x_log10</span>()<span class="sc">+</span><span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="dv">10</span>),<span class="at">trans=</span><span class="st">&quot;log&quot;</span>)</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="gráficos-avanzados.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(obesidad,<span class="fu">aes</span>(<span class="at">x=</span>renta,<span class="at">y=</span>imc,<span class="at">color=</span>region))<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>) <span class="sc">+</span> </span>
<span id="cb44-2"><a href="gráficos-avanzados.html#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span>.<span class="dv">1</span>,<span class="at">alpha=</span>.<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb44-3"><a href="gráficos-avanzados.html#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()<span class="sc">+</span><span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="dv">10</span>),<span class="at">trans=</span><span class="st">&quot;log&quot;</span>)<span class="sc">+</span></span>
<span id="cb44-4"><a href="gráficos-avanzados.html#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;Continente&quot;</span>,<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;green4&quot;</span>,<span class="st">&quot;red4&quot;</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="st">&quot;Europa&quot;</span>,<span class="st">&quot;Asia&quot;</span>))</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
</div>
<div id="temas" class="section level4" number="2.1.5.3">
<h4><span class="header-section-number">2.1.5.3</span> Temas</h4>
<p>Los <em>temas</em> de <code>ggplot2</code> permiten modificar aspectos estéticos del gráfico que no tienen que ver con los datos en sí. Eso incluye los ejes, etiquetas, colores de fondo, el tamaño de los márgenes, etc. Cambiar el tema por defecto, puede ser útil cuando los gráficos tienen que adecuarse a una imagen corporativa o atenerse a algún criterio de publicación.</p>
<p>El tema que usa <code>ggplot2</code> por defecto es <code>theme_grey</code>. Al escribir <code>theme_grey()</code> en la consola de R, se muestran alrededor de cuarenta elementos modificables y sus atributos tal y como los define dicho tema.</p>
<p>¿Qué se puede hacer con los temas? Una primera opción es elegir otro. Por ejemplo, se puede reemplazar el habitual por otros disponibles en el paquete como <code>theme_bw</code> (o <code>theme_classic</code>) haciendo</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="gráficos-avanzados.html#cb45-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>region) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb45-2"><a href="gráficos-avanzados.html#cb45-2" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>region) <span class="sc">+</span> <span class="fu">theme_classic</span>()</span></code></pre></div>
<p>Es posible usar tanto los temas que incluye <code>ggplot2</code> por defecto como otros creados por la comunidad. Algunos, por ejemplo, tratan de imitar el estilo de publicaciones reconocidas como The Economist o similares. Algunos están recogidos en paquetes como, por ejemplo, <code>ggthemes</code>.</p>
</div>
<div id="exportación-de-los-graficos" class="section level4" number="2.1.5.4">
<h4><span class="header-section-number">2.1.5.4</span> Exportación de los graficos</h4>
<p>Una vez creado un gráfico, es posible exportarlo en diversos formatos:</p>
<ul>
<li>Imagen tipo bitmap (<code>jpeg</code>,<code>png</code>,<code>bmp</code>,<code>tiff</code>,…)</li>
<li>Imagen vectorial (<code>pdf</code>,<code>svg</code>,…)</li>
</ul>
<p>La función <code>ggsave</code> guarda en un fichero el último gráfico generado con <code>ggplot2</code>. Lo hace, además, en el formato indicado en el nombre del fichero que se quiere generar. Así,</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="gráficos-avanzados.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(obesidad,<span class="fu">aes</span>(<span class="at">x=</span>renta,<span class="at">y=</span>imc,<span class="at">color=</span>region))<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>)</span>
<span id="cb46-2"><a href="gráficos-avanzados.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;obesidad.pdf&quot;</span>)</span>
<span id="cb46-3"><a href="gráficos-avanzados.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(&quot;mortalidad.pdf&quot;, width = 20, height = 20, units = &quot;cm&quot;)</span></span>
<span id="cb46-4"><a href="gráficos-avanzados.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;obesidad.png&quot;</span>)</span></code></pre></div>
<p>Si no se especifica ruta, las imágenes serán guardadas en el directorio de trabajo.</p>
<div class="nota">
<p>
Las imágenes vectoriales tienen una resolución “infinita” y suelen ocupar poca memoria. Sin embargo, no todos los editores de texto admiten este tipo de formato.
</p>
</div>
<div class="ej">
<p>
A partir de los datos de temperaturas anuales en Lisboa de 1880 a 2008 (base de datos temp_lisboa.csv), crear y exportar el siguiente gráfico, utilizando la capa <code>geom_tile</code>, el tema vacio <code>theme_void()</code> y la paleta de colores “RdBu” (<code>scale_fill_distiller(palette = ‘RdBu’)</code>).
</p>
</div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-84-1.png" width="672" /></p>

</div>
</div>
</div>
<div id="mapas" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Mapas</h2>
<ul>
<li><p>Con <code>ggplot2</code> se puede también construir representaciones gráficas con información geográfica (puntos, segmentos, etc.): basta con que las estéticas <code>x</code> e <code>y</code> se correspondan con la longitud y la latitud de los datos.</p></li>
<li><p>Lo que permite hacer el paquete <code>ggmap</code> es, en esencia, añadir a una representación grafica de datos georeferenciados una capa cartográfica adicional. Para eso usa recursos disponibles en la <em>web</em> a través de APIs (de Google y otros).</p></li>
</ul>
<p>Un ejemplo sencillo ilustra los usos de <code>ggmap</code>. En primer lugar, se carga (si se ha instalado previamente) el paquete:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="gráficos-avanzados.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span></code></pre></div>
<p>Existen varios proveedores que proporcionan APIs de geolocalización. Uno de ellos es Google: dado el nombre más o menos normalizado de un lugar, la API de Google devuelve sus coordenadas. Este servicio tiene una versión gratuita que permite realizar un determinado número de consultas diarias (2500 actualmente); para usos más intensivos, es necesario adquirir una licencia.</p>
<p>La función <code>geocode</code> encapsula la consulta a dicha API y devuelve un objeto (un <code>data.frame</code>) que contiene las coordenadas del lugar de interés:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="gráficos-avanzados.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cne&lt;- geocode(&#39;Calle Monforte de Lemos 5, madrid&#39;) #sólo funciona con licencia de Google</span></span>
<span id="cb48-2"><a href="gráficos-avanzados.html#cb48-2" aria-hidden="true" tabindex="-1"></a>cne <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="at">lat=</span> <span class="fl">40.47767</span>,<span class="at">lon=</span><span class="sc">-</span><span class="fl">3.691096</span>)</span>
<span id="cb48-3"><a href="gráficos-avanzados.html#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="gráficos-avanzados.html#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="do">### Una alternativa gratuita sin limites para direcciones en España </span></span>
<span id="cb48-5"><a href="gráficos-avanzados.html#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">#require(caRtociudad)</span></span>
<span id="cb48-6"><a href="gráficos-avanzados.html#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co">#cne &lt;- cartociudad_geocode(&#39;Calle Monforte de Lemos 5, madrid&#39;)</span></span>
<span id="cb48-7"><a href="gráficos-avanzados.html#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="gráficos-avanzados.html#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="do">### Otra alternativa OSM</span></span>
<span id="cb48-9"><a href="gráficos-avanzados.html#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co"># require(tmaptools)</span></span>
<span id="cb48-10"><a href="gráficos-avanzados.html#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co"># cne=geocode_OSM(&#39;Monforte de Lemos 5, madrid&#39;)</span></span></code></pre></div>
<p>La función <code>get_map</code> consulta otro servicio de información cartográfica (GoogleMaps en el ejemplo siguiente) y descarga un mapa (que es, esencialmente, una imagen <em>raster</em>).</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="gráficos-avanzados.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(caRtociudad)</span>
<span id="cb49-2"><a href="gráficos-avanzados.html#cb49-2" aria-hidden="true" tabindex="-1"></a>mapa<span class="ot">=</span><span class="fu">cartociudad_get_map</span>(cne,<span class="at">radius=</span><span class="dv">2</span>)</span>
<span id="cb49-3"><a href="gráficos-avanzados.html#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co">#cne&lt;-c(left=-3.7,bottom=40.47,right=-3.68,top=40.485)</span></span>
<span id="cb49-4"><a href="gráficos-avanzados.html#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co">#mapa &lt;- get_stamenmap(ens,zoom = 16,maptype=&quot;toner-lite&quot;)</span></span></code></pre></div>
<p>Es obvio que para poder invocar las dos funciones anteriores hace falta una conexión a Internet. Sin embargo, el resto de las operaciones que se van a realizar se ejecutan localmente. Se puede, por ejemplo, representar el mapa directamente (con la función <code>ggmap</code>):</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="gráficos-avanzados.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggmap</span>(mapa)</span></code></pre></div>
<p>O bien se puede marcar sobre él puntos de interés:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="gráficos-avanzados.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(data.table)</span>
<span id="cb51-2"><a href="gráficos-avanzados.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(sf)</span>
<span id="cb51-3"><a href="gráficos-avanzados.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># localización de los bares con terrazas de Madrid</span></span>
<span id="cb51-4"><a href="gráficos-avanzados.html#cb51-4" aria-hidden="true" tabindex="-1"></a>terrazas<span class="ot">=</span><span class="fu">fread</span>(<span class="st">&quot;data/terrazas.csv&quot;</span>) </span>
<span id="cb51-5"><a href="gráficos-avanzados.html#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggmap</span>(mapa) <span class="sc">+</span>  </span>
<span id="cb51-6"><a href="gráficos-avanzados.html#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>lon,<span class="at">y=</span>lat),<span class="at">data =</span> terrazas,<span class="at">colour =</span> <span class="st">&#39;red3&#39;</span>,<span class="at">size =</span> <span class="dv">3</span>,<span class="at">alpha=</span>.<span class="dv">5</span>)</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-89-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="gráficos-avanzados.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Obtención de la base de datos ######</span></span>
<span id="cb52-2"><a href="gráficos-avanzados.html#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># temp=fread(&quot;https://datos.madrid.es/egob/catalogo/200085-19-censo-locales.csv&quot;,quote=&#39;&#39;,dec=&quot;,&quot;)</span></span>
<span id="cb52-3"><a href="gráficos-avanzados.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-4"><a href="gráficos-avanzados.html#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ###### Cambio de proyección</span></span>
<span id="cb52-5"><a href="gráficos-avanzados.html#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co"># str(mapa) #localización del lienzo</span></span>
<span id="cb52-6"><a href="gráficos-avanzados.html#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-7"><a href="gráficos-avanzados.html#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Terrazas=st_as_sf(temp,coords=c(&quot;coordenada_x_local&quot;,&quot;coordenada_y_local&quot;))  %&gt;% </span></span>
<span id="cb52-8"><a href="gráficos-avanzados.html#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   st_set_crs(&quot;+proj=utm +zone=30&quot;) %&gt;% </span></span>
<span id="cb52-9"><a href="gráficos-avanzados.html#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   st_transform(&quot;+proj=longlat&quot;)</span></span>
<span id="cb52-10"><a href="gráficos-avanzados.html#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-11"><a href="gráficos-avanzados.html#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ###### representación con sf</span></span>
<span id="cb52-12"><a href="gráficos-avanzados.html#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ggmap(mapa)+</span></span>
<span id="cb52-13"><a href="gráficos-avanzados.html#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(data=Terrazas,inherit.aes = FALSE,colour = &#39;red3&#39;,size = 3,alpha=.5)</span></span>
<span id="cb52-14"><a href="gráficos-avanzados.html#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-15"><a href="gráficos-avanzados.html#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-16"><a href="gráficos-avanzados.html#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # coordenadas en formato data.frame</span></span>
<span id="cb52-17"><a href="gráficos-avanzados.html#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="co"># terrazas= Terrazas %&gt;% st_coordinates() %&gt;% as.data.table() </span></span>
<span id="cb52-18"><a href="gráficos-avanzados.html#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co"># names(terrazas)&lt;-c(&quot;lon&quot;,&quot;lat&quot;)</span></span>
<span id="cb52-19"><a href="gráficos-avanzados.html#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-20"><a href="gráficos-avanzados.html#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb52-21"><a href="gráficos-avanzados.html#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="co"># # Alternativa con mapa dinamico</span></span>
<span id="cb52-22"><a href="gráficos-avanzados.html#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="co"># require(tmap)</span></span>
<span id="cb52-23"><a href="gráficos-avanzados.html#cb52-23" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_mode(&quot;view&quot;)</span></span>
<span id="cb52-24"><a href="gráficos-avanzados.html#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="co"># tm_shape(Terrazas) +</span></span>
<span id="cb52-25"><a href="gráficos-avanzados.html#cb52-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     tm_dots(col = &#39;red3&#39;,alpha=.5)+</span></span>
<span id="cb52-26"><a href="gráficos-avanzados.html#cb52-26" aria-hidden="true" tabindex="-1"></a><span class="co">#     tm_view(set.view = c(-3.7, 40.5, 10)) #cerca cne</span></span></code></pre></div>
<p>Como puede apreciarse, la sintaxis es similar a la de <code>ggplot2</code>. Una diferencia notable es que, ahora, los datos se pasan en la capa, es decir, en este caso, en la función <code>geom_point</code>.</p>
<div id="más-ejemplos-de-mapas-con-puntos" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Más ejemplos de mapas con puntos</h3>
<p>En los ejemplos que siguen se va a utilizar el conjunto de datos <code>crimes</code> que forma parte del paquete <code>ggmap</code> y que incluye información geo-localizada de crímenes cometidos en la ciudad de Houston. En realidad, solo consideraremos los crímenes <em>serios</em>, es decir,</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="gráficos-avanzados.html#cb53-1" aria-hidden="true" tabindex="-1"></a>crimes.houston <span class="ot">&lt;-</span> <span class="fu">subset</span>(crime,<span class="sc">!</span>crime<span class="sc">$</span>offense <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;auto theft&quot;</span>, <span class="st">&quot;theft&quot;</span>, <span class="st">&quot;burglary&quot;</span>))</span></code></pre></div>
<p>El tipo de mapas más simples son los que se limitan a representar puntos sobre una capa cartográfica.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="gráficos-avanzados.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#require(tmaptools) #para geolocalizar Houston</span></span>
<span id="cb54-2"><a href="gráficos-avanzados.html#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co">#houston&lt;-geocode_OSM(&#39;Houston&#39;)</span></span>
<span id="cb54-3"><a href="gráficos-avanzados.html#cb54-3" aria-hidden="true" tabindex="-1"></a>houston<span class="ot">=</span><span class="fu">c</span>(<span class="at">left =</span> <span class="sc">-</span><span class="fl">95.4</span>, <span class="at">bottom =</span> <span class="fl">29.74</span>, <span class="at">right =</span> <span class="sc">-</span><span class="fl">95.35</span>, <span class="at">top =</span> <span class="fl">29.78</span>)</span>
<span id="cb54-4"><a href="gráficos-avanzados.html#cb54-4" aria-hidden="true" tabindex="-1"></a>houston.callejero <span class="ot">&lt;-</span> <span class="fu">get_stamenmap</span>(houston,<span class="at">zoom=</span><span class="dv">14</span>,<span class="at">maptype=</span><span class="st">&quot;toner-lite&quot;</span>)</span>
<span id="cb54-5"><a href="gráficos-avanzados.html#cb54-5" aria-hidden="true" tabindex="-1"></a>H <span class="ot">&lt;-</span> <span class="fu">ggmap</span>(houston.callejero)</span>
<span id="cb54-6"><a href="gráficos-avanzados.html#cb54-6" aria-hidden="true" tabindex="-1"></a>H <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">colour =</span> offense), <span class="at">data =</span> crimes.houston, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-90-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="ej">
<p>
Los mecanismos conocidos de <code>ggplot2</code>, como las facetas, están disponibles en <code>ggmap</code>. Descomponer el anterior gráfico utilizando <code>facet_wrap</code> por tipo de crimen (ver gráfico siguiente). Hacer lo mismo con el día de la semana.
</p>
</div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-92-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="ej">
<p>
Pintar las gasolineras en el mapa de España (o de una provincia o un municipio) utilizando el fichero <code>data/carburantes.csv</code>. Modificar el tamaño (o color) de los puntos en función de, por ejemplo, el precio de los carburantes.
</p>
</div>
</div>
<div id="más-allá-de-los-puntos-densidades-y-poligonos" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Más allá de los puntos: densidades y poligonos</h3>
<p>Además de <code>geom_point</code>, también están disponibles otros tipos de capas de <code>ggplot2</code>, como <code>stat_bin2d</code>, que cuenta el número de eventos (aquí atracos) que suceden en regiones cuadradas de un tamaño predefinido. Se puede también utilizar <code>stat_density2d</code>, que representa densidades, para identificar las zonas de mayor criminalidad.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="gráficos-avanzados.html#cb55-1" aria-hidden="true" tabindex="-1"></a>HoustonMap <span class="sc">+</span></span>
<span id="cb55-2"><a href="gráficos-avanzados.html#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density2d</span>(<span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">alpha =</span> ..level..),<span class="at">fill=</span><span class="st">&quot;red4&quot;</span>,</span>
<span id="cb55-3"><a href="gráficos-avanzados.html#cb55-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">2</span>, <span class="at">data =</span> <span class="fu">subset</span>(crimes.houston,offense<span class="sc">==</span><span class="st">&quot;robbery&quot;</span>),</span>
<span id="cb55-4"><a href="gráficos-avanzados.html#cb55-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">geom =</span> <span class="st">&quot;polygon&quot;</span>)</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-95-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Por otra parte, la información estadística puede ser proporcionada de manera agregada en unidades espaciales (a nivel provincial, municipal, …), como para los datos del paro.</p>
<p>Lo primero que se necesita para representar estar datos, es el conjunto de polígonos (o “shape”) que definen las secciones geográficas. Esta información se puede por ejemplo descargar desde el servidor <code>GADM</code>mediante el paquete <code>raster</code>:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="gráficos-avanzados.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(raster)  </span>
<span id="cb56-2"><a href="gráficos-avanzados.html#cb56-2" aria-hidden="true" tabindex="-1"></a>shape <span class="ot">&lt;-</span> <span class="fu">getData</span>(<span class="st">&quot;GADM&quot;</span>, <span class="at">country=</span> <span class="st">&quot;Spain&quot;</span>, <span class="at">level =</span> <span class="dv">2</span>, <span class="at">type=</span><span class="st">&quot;sf&quot;</span>) <span class="co">#mapa administrativo a nivel provincial</span></span>
<span id="cb56-3"><a href="gráficos-avanzados.html#cb56-3" aria-hidden="true" tabindex="-1"></a>peninsula <span class="ot">&lt;-</span> <span class="fu">subset</span>(shape,<span class="sc">!</span>NAME_1<span class="sc">==</span><span class="st">&quot;Islas Canarias&quot;</span>) <span class="co">#mapa sin las islas canarias</span></span>
<span id="cb56-4"><a href="gráficos-avanzados.html#cb56-4" aria-hidden="true" tabindex="-1"></a>peninsula </span></code></pre></div>
<pre><code>## Simple feature collection with 50 features and 13 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -9.301806 ymin: 35.17058 xmax: 4.328195 ymax: 43.79153
## Geodetic CRS:  WGS 84
## First 10 features:
##    GID_0 NAME_0   GID_1    NAME_1 NL_NAME_1     GID_2  NAME_2
## 1    ESP  Spain ESP.1_1 Andalucía      &lt;NA&gt; ESP.1.1_1 Almería
## 2    ESP  Spain ESP.1_1 Andalucía      &lt;NA&gt; ESP.1.2_1   Cádiz
## 3    ESP  Spain ESP.1_1 Andalucía      &lt;NA&gt; ESP.1.3_1 Córdoba
## 4    ESP  Spain ESP.1_1 Andalucía      &lt;NA&gt; ESP.1.4_1 Granada
## 5    ESP  Spain ESP.1_1 Andalucía      &lt;NA&gt; ESP.1.5_1  Huelva
## 6    ESP  Spain ESP.1_1 Andalucía      &lt;NA&gt; ESP.1.6_1    Jaén
## 7    ESP  Spain ESP.1_1 Andalucía      &lt;NA&gt; ESP.1.7_1  Málaga
## 8    ESP  Spain ESP.1_1 Andalucía      &lt;NA&gt; ESP.1.8_1 Sevilla
## 27   ESP  Spain ESP.2_1    Aragón      &lt;NA&gt; ESP.2.1_1  Huesca
## 28   ESP  Spain ESP.2_1    Aragón      &lt;NA&gt; ESP.2.2_1  Teruel
##    VARNAME_2 NL_NAME_2    TYPE_2 ENGTYPE_2 CC_2   HASC_2
## 1       &lt;NA&gt;      &lt;NA&gt; Provincia  Province   04 ES.AN.AM
## 2       &lt;NA&gt;      &lt;NA&gt; Provincia  Province   11 ES.AN.CD
## 3       &lt;NA&gt;      &lt;NA&gt; Provincia  Province   14 ES.AN.CO
## 4       &lt;NA&gt;      &lt;NA&gt; Provincia  Province   18 ES.AN.GD
## 5       &lt;NA&gt;      &lt;NA&gt; Provincia  Province   21 ES.AN.HL
## 6       &lt;NA&gt;      &lt;NA&gt; Provincia  Province   23 ES.AN.JA
## 7       &lt;NA&gt;      &lt;NA&gt; Provincia  Province   29 ES.AN.MG
## 8       &lt;NA&gt;      &lt;NA&gt; Provincia  Province   41 ES.AN.SV
## 27      &lt;NA&gt;      &lt;NA&gt; Provincia  Province   22 ES.AR.HS
## 28      &lt;NA&gt;      &lt;NA&gt; Provincia  Province   44 ES.AR.TE
##                          geometry
## 1  MULTIPOLYGON (((-3.030417 3...
## 2  MULTIPOLYGON (((-6.219583 3...
## 3  MULTIPOLYGON (((-5.048538 3...
## 4  MULTIPOLYGON (((-3.35014 36...
## 5  MULTIPOLYGON (((-6.836479 3...
## 6  MULTIPOLYGON (((-3.008117 3...
## 7  MULTIPOLYGON (((-4.000826 3...
## 8  MULTIPOLYGON (((-5.941178 3...
## 27 MULTIPOLYGON (((0.347473 41...
## 28 MULTIPOLYGON (((0.026484 40...</code></pre>
<p>Se puede representar este mapa utilizando <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="gráficos-avanzados.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(peninsula) <span class="sc">+</span> </span>
<span id="cb58-2"><a href="gráficos-avanzados.html#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill=</span>NAME_1),<span class="at">alpha=</span>.<span class="dv">1</span>,<span class="at">col=</span><span class="st">&quot;grey80&quot;</span>,<span class="at">show.legend =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb58-3"><a href="gráficos-avanzados.html#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>NAME_2),<span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb58-4"><a href="gráficos-avanzados.html#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-97-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Ahora pintamos en el mapa los datos del paro (Mujeres, 2011, primer trimestre):</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="gráficos-avanzados.html#cb59-1" aria-hidden="true" tabindex="-1"></a>paro<span class="ot">=</span><span class="fu">fread</span>(<span class="st">&quot;data/paro.csv&quot;</span>,<span class="at">encoding=</span><span class="st">&quot;UTF-8&quot;</span>)</span>
<span id="cb59-2"><a href="gráficos-avanzados.html#cb59-2" aria-hidden="true" tabindex="-1"></a>paro[,id<span class="sc">:</span><span class="er">=</span><span class="fu">sub</span>(<span class="st">&quot; &quot;</span>,<span class="st">&quot;0&quot;</span>,<span class="fu">format</span>(Prov.id,<span class="at">width=</span><span class="dv">2</span>))]</span>
<span id="cb59-3"><a href="gráficos-avanzados.html#cb59-3" aria-hidden="true" tabindex="-1"></a>Paro <span class="ot">&lt;-</span> <span class="fu">subset</span>(paro,Año<span class="sc">==</span><span class="dv">2011</span> <span class="sc">&amp;</span> Trimestre<span class="sc">==</span><span class="st">&quot;I&quot;</span>)</span>
<span id="cb59-4"><a href="gráficos-avanzados.html#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="gráficos-avanzados.html#cb59-5" aria-hidden="true" tabindex="-1"></a>peninsula<span class="sc">$</span>id<span class="ot">=</span>peninsula<span class="sc">$</span>CC_2</span>
<span id="cb59-6"><a href="gráficos-avanzados.html#cb59-6" aria-hidden="true" tabindex="-1"></a>peninsula.paro<span class="ot">=</span><span class="fu">merge</span>(peninsula,Paro,<span class="at">by=</span><span class="st">&quot;id&quot;</span>) <span class="co">#juntamos las dos bases</span></span>
<span id="cb59-7"><a href="gráficos-avanzados.html#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="gráficos-avanzados.html#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(peninsula.paro) <span class="sc">+</span> </span>
<span id="cb59-9"><a href="gráficos-avanzados.html#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill=</span>Tasa.paro), <span class="at">colour =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">size =</span> .<span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb59-10"><a href="gráficos-avanzados.html#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> Sexo) <span class="sc">+</span>    </span>
<span id="cb59-11"><a href="gráficos-avanzados.html#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="st">&quot;Tasa paro&quot;</span>,<span class="at">low=</span><span class="st">&quot;aliceblue&quot;</span>,<span class="at">high=</span><span class="st">&quot;steelblue4&quot;</span>)<span class="sc">+</span></span>
<span id="cb59-12"><a href="gráficos-avanzados.html#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-98-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>Podemos incluso dibujar este mapa, sobre un lienzo obtenido mediante <code>get_map</code>:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="gráficos-avanzados.html#cb60-1" aria-hidden="true" tabindex="-1"></a>bb<span class="ot">=</span><span class="fu">st_bbox</span>(peninsula)</span>
<span id="cb60-2"><a href="gráficos-avanzados.html#cb60-2" aria-hidden="true" tabindex="-1"></a>españa <span class="ot">&lt;-</span> <span class="fu">get_stamenmap</span>(<span class="fu">unname</span>(bb),<span class="at">zoom=</span><span class="dv">6</span>,<span class="at">maptype=</span><span class="st">&quot;toner-lite&quot;</span>)</span>
<span id="cb60-3"><a href="gráficos-avanzados.html#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="gráficos-avanzados.html#cb60-4" aria-hidden="true" tabindex="-1"></a>mujeres<span class="ot">=</span><span class="fu">subset</span>(peninsula.paro,Sexo<span class="sc">==</span><span class="st">&quot;Mujeres&quot;</span>)</span>
<span id="cb60-5"><a href="gráficos-avanzados.html#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="gráficos-avanzados.html#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggmap</span>(españa) <span class="sc">+</span> </span>
<span id="cb60-7"><a href="gráficos-avanzados.html#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mujeres, <span class="fu">aes</span>(<span class="at">fill=</span>Tasa.paro),<span class="at">alpha=</span>.<span class="dv">5</span>,<span class="at">inherit.aes=</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb60-8"><a href="gráficos-avanzados.html#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">direction=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb60-9"><a href="gráficos-avanzados.html#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">datum=</span><span class="fu">st_crs</span>(<span class="dv">3857</span>)) <span class="co">#No muy alineado!</span></span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-99-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="gráficos-avanzados.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#version dinamica con tmap</span></span>
<span id="cb61-2"><a href="gráficos-avanzados.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co">#tm_shape(mujeres)+tm_polygons(&quot;Tasa.paro&quot;)</span></span></code></pre></div>

</div>
</div>
<div id="árboles-filogenéticos" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Árboles filogenéticos</h2>
<div id="importación-de-un-árbol" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Importación de un árbol</h3>
<ul>
<li>Un árbol filogenético es un esquema arborescente que muestra las relaciones evolutivas entre varias especies u otras entidades que se cree que tienen una ascendencia común”” (Wikipedia).</li>
</ul>
<div class="figure">
<img src="imagenes/Tree_of_life_int.svg.png" alt="" />
<p class="caption">El árbol de la vida</p>
</div>
<ul>
<li><p>El método de construcción de árboles filogenéticos consiste en analizar rasgos heredables (secuencias de ADN) o caracteres morfológicos con el fin de establecer relaciones de parentesco entre especies (o taxones). Casi todos los métodos filogenéticos comienzan con una matriz de distancia en la cual las diferencias entre taxones se estiman sumando discrepancias en nucleótidos o caracteres morfológicos cuantitativos. Cada nodo del árbol representa el ancestro común.</p></li>
<li><p>Sin embargo, aquí no entraremos en la construcción de los arboles, sino simplemente en su representación gráfica. Suponemos pues que ya disponemos de un árbol filogenético. El paquete <code>treeio</code> sirve como interfaz para importar varios arboles en varios formatos (Newick, Nexus, NHX, jplace, ….).</p></li>
</ul>
<p>EL siguiente comando permite instalar el paquete <code>ggtree</code>y sus dependencias (incluye el paquete <code>treeio</code>) desde el repositorio de <code>Bioconductor</code>.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="gráficos-avanzados.html#cb62-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;YuLab-SMU/ggtree&quot;</span>)</span></code></pre></div>
<p>A continuación importamos un árbol sobre filogenia de primates:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="gráficos-avanzados.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(treeio) </span>
<span id="cb63-2"><a href="gráficos-avanzados.html#cb63-2" aria-hidden="true" tabindex="-1"></a>url<span class="ot">=</span><span class="st">&quot;https://raw.githubusercontent.com/rgriff23/Dissertation/master/Chapter_2/data/tree.nex&quot;</span></span>
<span id="cb63-3"><a href="gráficos-avanzados.html#cb63-3" aria-hidden="true" tabindex="-1"></a>arbol <span class="ot">&lt;-</span> <span class="fu">read.nexus</span>(url)</span>
<span id="cb63-4"><a href="gráficos-avanzados.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arbol)</span></code></pre></div>
<pre><code>## 
## Phylogenetic tree: arbol 
## 
##   Number of tips: 65 
##   Number of nodes: 64 
##   Branch lengths:
##     mean: 10.01834 
##     variance: 67.22004 
##     distribution summary:
##      Min.   1st Qu.    Median   3rd Qu.      Max. 
##  0.401789  4.710731  8.266731 14.271122 51.124065 
##   No root edge.
##   First ten tip labels: Allenopithecus_nigroviridis 
##                         Cercopithecus_mitis
##                         Cercopithecus_petaurista
##                         Chlorocebus_sabaeus
##                         Erythrocebus_patas
##                         Miopithecus_ogouensis
##                         Avahi_laniger
##                         Cheirogaleus_major
##                         Daubentonia_madagascarensis
##                         Eulemur_fulvus
##   No node labels.</code></pre>
</div>
<div id="representación-básica" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Representación básica</h3>
<p>Vamos ahora a Explorar la estructura del árbol mediante el comando <code>ggtree</code></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="gráficos-avanzados.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb65-2"><a href="gráficos-avanzados.html#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggtree)</span>
<span id="cb65-3"><a href="gráficos-avanzados.html#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtree</span>(arbol)</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-102-1.png" width="672" /></p>
<p>Para poder añadir las etiquetas de los nodos finales utilizamos el comando <code>geom_tiplab</code>:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="gráficos-avanzados.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtree</span>(arbol)<span class="sc">+</span><span class="fu">geom_tiplab</span>(<span class="at">size=</span><span class="dv">2</span>,<span class="at">offset=</span>.<span class="dv">5</span>)<span class="sc">+</span><span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">100</span>)</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-103-1.png" width="672" /></p>
<p>Además de la representación rectangular, otros sistemas de coordenadas (circular, radial, …) son disponibles utilizando la opción <code>layout</code>:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="gráficos-avanzados.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb67-2"><a href="gráficos-avanzados.html#cb67-2" aria-hidden="true" tabindex="-1"></a>pa <span class="ot">&lt;-</span><span class="fu">ggtree</span>(arbol) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;rectangular&quot;</span>)</span>
<span id="cb67-3"><a href="gráficos-avanzados.html#cb67-3" aria-hidden="true" tabindex="-1"></a>pa.bis <span class="ot">&lt;-</span> <span class="fu">ggtree</span>(arbol) <span class="sc">+</span> <span class="fu">coord_flip</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;rectangular invertido&quot;</span>)</span>
<span id="cb67-4"><a href="gráficos-avanzados.html#cb67-4" aria-hidden="true" tabindex="-1"></a>pb <span class="ot">&lt;-</span> <span class="fu">ggtree</span>(arbol, <span class="at">layout=</span><span class="st">&quot;slanted&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;slanted&quot;</span>)</span>
<span id="cb67-5"><a href="gráficos-avanzados.html#cb67-5" aria-hidden="true" tabindex="-1"></a>pc <span class="ot">&lt;-</span> <span class="fu">ggtree</span>(arbol, <span class="at">layout=</span><span class="st">&quot;circular&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;circular&quot;</span>)</span>
<span id="cb67-6"><a href="gráficos-avanzados.html#cb67-6" aria-hidden="true" tabindex="-1"></a>pd <span class="ot">&lt;-</span> <span class="fu">ggtree</span>(arbol, <span class="at">layout=</span><span class="st">&quot;radial&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;radial&quot;</span>)</span>
<span id="cb67-7"><a href="gráficos-avanzados.html#cb67-7" aria-hidden="true" tabindex="-1"></a>pe <span class="ot">&lt;-</span> <span class="fu">ggtree</span>(arbol, <span class="at">layout=</span><span class="st">&quot;unrooted&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;unrooted&quot;</span>)</span>
<span id="cb67-8"><a href="gráficos-avanzados.html#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="fu">multiplot</span>(pa, pa.bis, pb, pc, pd, pe, <span class="at">ncol=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-104-1.png" width="672" /></p>
</div>
<div id="agrupación-de-nodos" class="section level3" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Agrupación de nodos</h3>
<p>La función <code>groupClade</code> permite agrupar nodos que comparten un mismo ancestro. A continuación agrupamos los nodos por familia de primates:
- Galagoidea (124)
- Lemuroidea (113)
- Tarsioidea (110)
- Ceboidea (96)
- Hominoidea (89)
- Cercopithecoidea (70)</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="gráficos-avanzados.html#cb68-1" aria-hidden="true" tabindex="-1"></a>nodos<span class="ot">=</span><span class="fu">c</span>(<span class="dv">124</span>, <span class="dv">113</span>, <span class="dv">110</span>, <span class="dv">96</span>, <span class="dv">89</span>, <span class="dv">70</span>)</span>
<span id="cb68-2"><a href="gráficos-avanzados.html#cb68-2" aria-hidden="true" tabindex="-1"></a>arbol<span class="ot">&lt;-</span><span class="fu">groupClade</span>(arbol,<span class="at">.node=</span>nodos) <span class="co">#agrupación por especie</span></span>
<span id="cb68-3"><a href="gráficos-avanzados.html#cb68-3" aria-hidden="true" tabindex="-1"></a>familias<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;galagoids&quot;</span>,<span class="st">&quot;lemurs&quot;</span>,<span class="st">&quot;tarsiers&quot;</span>,<span class="st">&quot;cebids&quot;</span>,<span class="st">&quot;hominoids&quot;</span>,<span class="st">&quot;cercopithecoids&quot;</span>)</span>
<span id="cb68-4"><a href="gráficos-avanzados.html#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtree</span>(arbol, <span class="fu">aes</span>(<span class="at">color=</span>group), <span class="at">layout=</span><span class="st">&#39;circular&#39;</span>) <span class="sc">+</span> </span>
<span id="cb68-5"><a href="gráficos-avanzados.html#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tiplab</span>(<span class="at">size=</span><span class="dv">2</span>, <span class="fu">aes</span>(<span class="at">angle=</span>angle))</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-105-1.png" width="672" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="gráficos-avanzados.html#cb69-1" aria-hidden="true" tabindex="-1"></a>code<span class="ot">=</span><span class="st">&quot;ggtree(arbol, aes(color=group)) + geom_tiplab(size=2)&quot;</span></span>
<span id="cb69-2"><a href="gráficos-avanzados.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>){</span>
<span id="cb69-3"><a href="gráficos-avanzados.html#cb69-3" aria-hidden="true" tabindex="-1"></a>  mas<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">&quot;geom_cladelabel(&quot;</span>,nodos[i],<span class="st">&quot;,&#39;&quot;</span>,familias[i],<span class="st">&quot;&#39;,offset=25, barsize=2,offset.text=2.5, fontsize=2, hjust=.2)&quot;</span>)</span>
<span id="cb69-4"><a href="gráficos-avanzados.html#cb69-4" aria-hidden="true" tabindex="-1"></a>  code<span class="ot">=</span><span class="fu">paste</span>(code,mas,<span class="at">sep=</span><span class="st">&quot;+&quot;</span>)</span>
<span id="cb69-5"><a href="gráficos-avanzados.html#cb69-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb69-6"><a href="gráficos-avanzados.html#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text=</span>code))</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-106-1.png" width="672" /></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="gráficos-avanzados.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="do">##### Explorar la estructura de los siguientes arboles</span></span>
<span id="cb70-2"><a href="gráficos-avanzados.html#cb70-2" aria-hidden="true" tabindex="-1"></a>arbol<span class="ot">&lt;-</span><span class="fu">read.tree</span>(<span class="st">&quot;http://www.phytools.org/eqg2015/data/anole.tre&quot;</span>) <span class="co">#filogenia de lagartijas</span></span>
<span id="cb70-3"><a href="gráficos-avanzados.html#cb70-3" aria-hidden="true" tabindex="-1"></a>arbol <span class="ot">&lt;-</span> <span class="fu">read.nexus</span>(<span class="st">&quot;https://raw.githubusercontent.com/rgriff23/Dissertation/master/Chapter_2/data/tree.nex&quot;</span>) <span class="co">#filogenia de primates</span></span></code></pre></div>
</div>
<div id="añadir-heatmap" class="section level3" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> Añadir Heatmap</h3>
<p>Simulamos cinco caracteres continuos (ejemplo: tamaño del cuerpo, …) de acuerdo al árbol filogenia:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="gráficos-avanzados.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(phytools)</span>
<span id="cb71-2"><a href="gráficos-avanzados.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># simulacion reproducible</span></span>
<span id="cb71-3"><a href="gráficos-avanzados.html#cb71-3" aria-hidden="true" tabindex="-1"></a>traits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">fastBM</span>(arbol, <span class="at">nsim=</span><span class="dv">5</span>))</span></code></pre></div>
<p>utilizando las función <code>gheatmap</code> para adjuntar un <em>heatmap</em> a la representación del árbol:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="gráficos-avanzados.html#cb72-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggtree</span>(arbol) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">100</span>) <span class="sc">+</span> <span class="fu">geom_tiplab</span>(<span class="at">size=</span><span class="dv">2</span>, <span class="at">offset=</span><span class="dv">17</span>) </span>
<span id="cb72-2"><a href="gráficos-avanzados.html#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="gráficos-avanzados.html#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># añade el heatmap</span></span>
<span id="cb72-4"><a href="gráficos-avanzados.html#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="fu">gheatmap</span>(p, traits, <span class="at">offset=</span><span class="fl">0.2</span>, <span class="at">width=</span><span class="fl">0.2</span>, <span class="at">low=</span><span class="st">&quot;darkgreen&quot;</span>, <span class="at">high=</span><span class="st">&quot;darkred&quot;</span>, <span class="at">colnames_position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">font.size=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-109-1.png" width="672" /></p>
</div>
<div id="visualización-de-multiple-arboles" class="section level3" number="2.3.5">
<h3><span class="header-section-number">2.3.5</span> Visualización de multiple arboles</h3>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="gráficos-avanzados.html#cb73-1" aria-hidden="true" tabindex="-1"></a>trees <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">40</span>), rtree)</span>
<span id="cb73-2"><a href="gráficos-avanzados.html#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(trees) <span class="ot">&lt;-</span> <span class="st">&quot;multiPhylo&quot;</span></span>
<span id="cb73-3"><a href="gráficos-avanzados.html#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtree</span>(trees) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>.id, <span class="at">scale=</span><span class="st">&quot;free&quot;</span>) <span class="sc">+</span> <span class="fu">geom_tiplab</span>(<span class="at">size=</span><span class="dv">2</span>) </span></code></pre></div>
<p><img src="graficosConR_files/figure-html/unnamed-chunk-110-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="gráficos-básicos-en-el-análisis-de-datos.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rmarkdown.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["graficosConR.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
